"0",""
"0","ben_target <- fsc_nw %>% "
"0","  group_by(admin3_pcode_old) %>% "
"0","  summarise(beneficiaries = sum(new_beneficiaries),"
"0","            partners = n_distinct(org_code)) %>% "
"0","  left_join(pin, by = c(""admin3_pcode_old"" = ""admin3_pcode"")) %>% "
"0","  mutate(reached_pc = beneficiaries / fs_targeted,"
"0","         reached_pc = ifelse(is.infinite(reached_pc), 1, reached_pc),"
"0","         fs_targeted = ifelse(fs_targeted == 0 & beneficiaries > 0, 1, fs_targeted),"
"0","         fs_targeted = round(fs_targeted, digits = 0)) %>% "
"0","  arrange(desc(reached_pc)) %>% "
"0","  select(state, township, fs_pin, fs_targeted, beneficiaries, reached_pc, partners) %>%"
"0","  ggplot(aes(x = fs_targeted, y = beneficiaries, colour = partners, "
"0","             text = paste0(township, "","", ""\n"","
"0","                           state, "","", ""\n"","
"0","                           ""beneficiaries: "", comma(beneficiaries, accuracy = 1), ""\n"","
"0","                           ""target: "", comma(fs_targeted, accuracy = 1), ""\n"","
"0","                           ""% of target: "", percent(reached_pc, accuracy = 2), ""\n"", "
"0","                           ""partners: "", partners))) + "
"0","  geom_abline(intercept = 0, slope = 1, lty = 2, colour = ""red"") + "
"0","  geom_point(aes(size = beneficiaries), alpha = 0.8) +"
"0","  scale_size_continuous(guide = ""none"") + "
"0","  scale_x_continuous(trans = ""log10"", labels = comma) + "
"0","  scale_y_continuous(trans = ""log10"", labels = comma) +"
"0","  scale_colour_viridis(direction = -1) +"
"0","  labs(x = ""Targeted population"", y = ""Beneficiaries"", "
"0","       title = ""Beneficiaries reached vs targeted population by township, Q1 2022"","
"0","       subtitle = ""The red line is 100% of target"") + "
"0","  theme(legend.title = element_text(size = 7))"
"0",""
"0","ggplotly(ben_target, tooltip = c(""text""), width = 820, height = 500) %>% "
"0","  config(displayModeBar = FALSE) %>% "
"0","  layout(title = list(text = paste0(""Beneficiaries reached vs targeted population by township, Q1 2022"","
"0","                                    ""<br>"","
"0","                                    ""<sup>"","
"0","                                    ""The red line is 100% of target; size indicates number of beneficiaries"",""</sup>"")), "
"0","         legend = list(font = list(size = 7)))"
